{
    "sourceFile": "api/songs/filter.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1757515935516,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1757516106319,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -44,9 +44,9 @@\n       query, \r\n       page: 0,\r\n       limit: limit \r\n     });\r\n-    let results = (data.data?.results || data.results || []).map(simplifySong);\r\n+    let results = (data.data?.results || data.results || []).map(simplifySong).filter(Boolean);\r\n     results = filterSongs(results, { language, year, minDuration, maxDuration });\r\n     results = sortSongs(results, sort);\r\n     res.json({ results });\r\n   } catch (e) {\r\n"
                }
            ],
            "date": 1757515935516,
            "name": "Commit-0",
            "content": "// /api/songs/filter\r\nimport { fetchFromJioSaavn } from '../utils/fetcher.js';\r\n\r\nfunction filterSongs(songs, { language, year, minDuration, maxDuration }) {\r\n  return songs.filter(song => {\r\n    let match = true;\r\n    if (language) match = match && song.language?.toLowerCase() === language.toLowerCase();\r\n    if (year) match = match && String(song.year) === String(year);\r\n    if (minDuration) match = match && Number(song.duration) >= Number(minDuration);\r\n    if (maxDuration) match = match && Number(song.duration) <= Number(maxDuration);\r\n    return match;\r\n  });\r\n}\r\n\r\nfunction sortSongs(songs, sort) {\r\n  if (sort === 'latest') return songs.sort((a, b) => (b.year || 0) - (a.year || 0));\r\n  if (sort === 'popularity') return songs.sort((a, b) => (b.playCount || 0) - (a.playCount || 0));\r\n  if (sort === 'duration') return songs.sort((a, b) => (b.duration || 0) - (a.duration || 0));\r\n  return songs;\r\n}\r\n\r\nfunction simplifySong(song) {\r\n  return {\r\n    id: song.id || song._id,\r\n    title: song.name || song.title,\r\n    artists: song.artists?.primary?.map(a => a.name).join(', ') || song.primaryArtists,\r\n    album: song.album?.name || song.album_name || song.album,\r\n    year: parseInt(song.year) || parseInt(song.releaseDate?.slice(0, 4)) || null,\r\n    duration: parseInt(song.duration) || null,\r\n    language: song.language,\r\n    playCount: parseInt(song.playCount) || 0,\r\n    url: song.url,\r\n    image: Array.isArray(song.image) ? (song.image.find(i => i.quality === '500x500')?.url || song.image[0]?.url) : song.image,\r\n    downloadUrl: song.downloadUrl || []\r\n  };\r\n}\r\n\r\nexport default async function handler(req, res) {\r\n  const { query, language, year, minDuration, maxDuration, sort, limit = 30 } = req.query;\r\n  if (!query) return res.status(400).json({ error: 'Missing query param' });\r\n  try {\r\n    // Get raw data with pagination parameters\r\n    const data = await fetchFromJioSaavn('/search/songs', { \r\n      query, \r\n      page: 0,\r\n      limit: limit \r\n    });\r\n    let results = (data.data?.results || data.results || []).map(simplifySong);\r\n    results = filterSongs(results, { language, year, minDuration, maxDuration });\r\n    results = sortSongs(results, sort);\r\n    res.json({ results });\r\n  } catch (e) {\r\n    res.status(500).json({ error: e.message });\r\n  }\r\n}\r\n"
        }
    ]
}